# Sample workflow for building and deploying an Astro site to GitHub Pages
#
# To get started with Astro see: https://docs.astro.build/en/getting-started/
#
name: Deploy Astro site to Pages

on:
  # Runs on pushes targeting the default branch
  push:
    branches: ["main"]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# Sets permissions of the GITHUB_TOKEN to allow deployment to GitHub Pages
permissions:
  contents: read
  pages: write
  id-token: write

# Allow only one concurrent deployment, skipping runs queued between the run in-progress and latest queued.
# However, do NOT cancel in-progress runs as we want to allow these production deployments to complete.
concurrency:
  group: "pages"
  cancel-in-progress: false

env:
  BUILD_PATH: "." # default value when not using subfolders
  # BUILD_PATH: subfolder

jobs:
  build:
    name: Build
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Detect package manager
        id: detect-package-manager
        run: |
          if [ -f "${{ github.workspace }}/yarn.lock" ]; then
            echo "manager=yarn" >> $GITHUB_OUTPUT
            echo "command=install" >> $GITHUB_OUTPUT
            echo "runner=yarn" >> $GITHUB_OUTPUT
            echo "lockfile=yarn.lock" >> $GITHUB_OUTPUT
            exit 0
          elif [ -f "${{ github.workspace }}/package.json" ]; then
            echo "manager=npm" >> $GITHUB_OUTPUT
            echo "command=ci" >> $GITHUB_OUTPUT
            echo "runner=npx --no-install" >> $GITHUB_OUTPUT
            echo "lockfile=package-lock.json" >> $GITHUB_OUTPUT
            exit 0
          else
            echo "Unable to determine package manager"
            exit 1
          fi
      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: "20"
          cache: ${{ steps.detect-package-manager.outputs.manager }}
          cache-dependency-path: ${{ env.BUILD_PATH }}/${{ steps.detect-package-manager.outputs.lockfile }}
      - name: Setup Pages
        id: pages
        uses: actions/configure-pages@v5
      - name: Install dependencies
        run: ${{ steps.detect-package-manager.outputs.manager }} ${{ steps.detect-package-manager.outputs.command }}
        working-directory: ${{ env.BUILD_PATH }}
      - name: Build with Astro
        run: |
          ${{ steps.detect-package-manager.outputs.runner }} astro build \
            --site "${{ steps.pages.outputs.origin }}" \
            --base "${{ steps.pages.outputs.base_path }}"
        working-directory: ${{ env.BUILD_PATH }}
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: ${{ env.BUILD_PATH }}/dist

  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    needs: build
    runs-on: ubuntu-latest
    name: Deploy
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
            - nama: Menyiapkan lingkungan Node.js
  penggunaan: actions/setup-node@v6.2.0
  dengan:
    # Spesifikasi Versi yang akan digunakan. Contoh: 12.x, 10.15.1, >=10.15.0.
    versi node: # opsional
    # File yang berisi spesifikasi versi yang akan digunakan. Contoh: package.json, .nvmrc, .node-version, .tool-versions.
    node-version-file: # opsional
    # Arsitektur target yang akan digunakan Node. Contoh: x86, x64. Secara default akan menggunakan arsitektur sistem.
    arsitektur: # opsional
    # Atur opsi ini jika Anda ingin tindakan tersebut memeriksa versi terbaru yang tersedia yang memenuhi spesifikasi versi.
    check-latest: # opsional
    # Registri opsional untuk pengaturan otentikasi. Registri akan diatur dalam file .npmrc dan .yarnrc tingkat proyek, dan mengatur otentikasi untuk membaca dari env.NODE_AUTH_TOKEN.
    URL registri: # opsional
    # Cakupan opsional untuk otentikasi terhadap registri yang tercakup. Akan kembali ke pemilik repositori saat menggunakan registri GitHub Packages (https://npm.pkg.github.com/).
    cakupan: # opsional
    # Digunakan untuk mengambil distribusi node dari node-versions. Karena ada nilai default, ini biasanya tidak diberikan oleh pengguna. Saat menjalankan tindakan ini di github.com, nilai default sudah cukup. Saat dijalankan di GHES, Anda dapat memberikan token akses pribadi untuk github.com jika Anda mengalami pembatasan laju permintaan (rate limiting).
    token: # opsional, defaultnya adalah ${{ github.server_url == 'https://github.com' && github.token || '' }}
    # Digunakan untuk menentukan pengelola paket untuk caching di direktori default. Nilai yang didukung: npm, yarn, pnpm.
    cache: # opsional
    # Atur ke false untuk menonaktifkan caching otomatis. Secara default, caching diaktifkan ketika devEngines.packageManager atau field packageManager tingkat atas di package.json menentukan npm sebagai pengelola paket.
    cache pengelola paket: # opsional, defaultnya adalah true
    # Digunakan untuk menentukan jalur ke file dependensi: package-lock.json, yarn.lock, dll. Mendukung wildcard atau daftar nama file untuk menyimpan beberapa dependensi dalam cache.
    cache-dependency-path: # opsional
    # Digunakan untuk menentukan mirror alternatif untuk mengunduh biner Node.js
    cermin: # opsional
    # Token yang digunakan sebagai header Otorisasi saat mengambil data dari mirror
    token cermin: # opsional
          
